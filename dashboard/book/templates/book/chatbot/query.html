{% extends 'book/base/base.html' %}
{% load crispy_forms_tags %}

{% block body %}
  <H1>Hello {{ current_page }}</H1>
  {% crispy form %}
  <div id="elasticsearch"></div>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
  <script>
    $("#submit-id-submit").click(function (e) {
      e.stopPropagation();
      e.preventDefault();

      let query = $("#id_query").val();
      let csrf = Cookies.get('csrftoken');
      let data = new FormData();
      data.append('query', query);
      data.append('csrfmiddlewaretoken', csrf);

      fetch("{% url 'book:elasticsearch' %}", {
        method: 'POST',
        body: data,
        credentials: 'same-origin'
      })
              .then(function (response) {
                $('#elasticsearch').text(response)
                console.log(response)
              })

    });
  </script>
{% endblock %}
